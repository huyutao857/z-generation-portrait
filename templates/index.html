<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Z世代用户画像分析（CSV数据版）</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
      /* 保持原有样式不变 */
      :root {
        --primary: #6366f1;
        --primary-light: #818cf8;
        --primary-dark: #4f46e5;
        --secondary: #ec4899;
        --secondary-light: #f472b6;
        --dark: #0f172a;
        --dark-light: #1e293b;
        --dark-lighter: #334155;
        --text: #f8fafc;
        --text-light: #e2e8f0;
        --text-muted: #94a3b8;
        --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        --card-gradient: linear-gradient(
          145deg,
          var(--dark-light),
          var(--dark)
        );
        --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        --card-shadow: 0 4px 20px rgba(99, 102, 241, 0.1);
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 20px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      body {
        background: var(--dark);
        color: var(--text);
        min-height: 100vh;
        background-image: radial-gradient(
            circle at 10% 20%,
            rgba(99, 102, 241, 0.1) 0%,
            transparent 20%
          ),
          radial-gradient(
            circle at 90% 80%,
            rgba(236, 72, 153, 0.1) 0%,
            transparent 20%
          );
        padding: 0;
      }

      .navbar {
        background: var(--dark-light);
        padding: 1rem 2rem;
        box-shadow: var(--shadow);
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .navbar-logo {
        display: flex;
        align-items: center;
        gap: 0.8rem;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: var(--gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: 700;
      }

      .logo-text {
        font-size: 1.25rem;
        font-weight: 700;
        background: var(--gradient);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .navbar-tagline {
        font-size: 0.875rem;
        color: var(--text-muted);
        margin-top: 0.2rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      .tab-nav {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
        scrollbar-width: none;
      }

      .tab-nav::-webkit-scrollbar {
        display: none;
      }

      .tab-btn {
        padding: 0.8rem 1.8rem;
        background: var(--dark-light);
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-light);
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        white-space: nowrap;
      }

      .tab-btn i {
        font-size: 1rem;
      }

      .tab-btn:hover {
        background: var(--dark-lighter);
        transform: translateY(-2px);
      }

      .tab-btn.active {
        background: var(--gradient);
        color: white;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
      }

      .content-card {
        display: none;
        background: var(--card-gradient);
        border-radius: var(--radius-lg);
        padding: 2rem;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(99, 102, 241, 0.1);
      }

      .content-card.active {
        display: block;
        animation: fadeIn 0.5s ease forwards;
      }

      .content-header {
        margin-bottom: 1.8rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      }

      .content-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.8rem;
      }

      .content-title i {
        color: var(--primary-light);
      }

      .content-desc {
        margin-top: 0.5rem;
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      /* 数据加载提示样式 */
      .data-loading {
        margin-bottom: 2rem;
        padding: 2rem;
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        border: 2px solid rgba(99, 102, 241, 0.3);
        text-align: center;
      }

      .data-loading-icon {
        font-size: 3rem;
        color: var(--primary-light);
        margin-bottom: 1rem;
      }

      .data-loading-text {
        color: var(--text-light);
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }

      /* CSV上传状态 */
      .csv-status {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: var(--radius-sm);
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        display: none;
      }

      .csv-status.active {
        display: block;
      }

      /* 数据预览区域 */
      .data-preview {
        margin: 1.5rem 0;
        padding: 1.5rem;
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        border: 1px solid rgba(99, 102, 241, 0.1);
        display: none;
      }

      .data-preview.active {
        display: block;
      }

      .data-preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .data-preview-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .data-preview-title i {
        color: var(--primary-light);
      }

      .data-table-container {
        max-height: 300px;
        overflow-y: auto;
        border-radius: var(--radius-sm);
        border: 1px solid rgba(148, 163, 184, 0.1);
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
      }

      .data-table th,
      .data-table td {
        padding: 0.8rem;
        text-align: left;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        white-space: nowrap;
      }

      .data-table th {
        background: rgba(15, 23, 42, 0.5);
        font-weight: 600;
        color: var(--primary-light);
        position: sticky;
        top: 0;
      }

      .data-table tr:hover {
        background: rgba(99, 102, 241, 0.05);
      }

      .data-table td {
        color: var(--text-light);
      }

      .chart-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
      }

      .chart-card {
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        border: 1px solid rgba(99, 102, 241, 0.1);
        transition: var(--transition);
        height: 400px;
        display: flex;
        flex-direction: column;
      }

      .chart-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.2);
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-shrink: 0;
      }

      .chart-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .chart-title i {
        color: var(--primary-light);
        font-size: 0.9rem;
      }

      .chart-container {
        flex: 1;
        width: 100% !important;
        height: 350px !important;
        min-height: 300px;
      }

      /* 表单样式 */
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
      }

      .form-group {
        margin-bottom: 1.2rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.6rem;
        color: var(--text);
        font-weight: 500;
        font-size: 0.9rem;
      }

      .form-input {
        width: 100%;
        padding: 0.9rem 1rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.15);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: 0.9rem;
        transition: var(--transition);
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        background: rgba(30, 41, 59, 1);
      }

      .form-input::placeholder {
        color: var(--text-muted);
      }

      /* 文件上传样式 */
      .file-upload {
        margin-bottom: 2rem;
        padding: 2rem;
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        border: 2px dashed rgba(99, 102, 241, 0.3);
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
      }

      .file-upload:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: var(--primary-light);
      }

      .file-upload-icon {
        font-size: 3rem;
        color: var(--primary-light);
        margin-bottom: 1rem;
      }

      .file-upload-text {
        color: var(--text-light);
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }

      .file-upload-hint {
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      #fileInput {
        display: none;
      }

      /* 按钮样式 */
      .btn-group {
        margin-top: 1.8rem;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .btn-primary,
      .btn-secondary {
        padding: 0.9rem 2rem;
        border-radius: var(--radius-sm);
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        border: none;
      }

      .btn-primary {
        background: var(--gradient);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
      }

      .btn-secondary {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.15);
        color: var(--text-light);
      }

      .btn-secondary:hover {
        background: rgba(30, 41, 59, 1);
        border-color: rgba(99, 102, 241, 0.2);
        transform: translateY(-2px);
      }

      /* 客群识别分类标题 */
      .category {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--primary-light);
        margin: 25px 0 15px 0;
        padding-bottom: 5px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .category i {
        font-size: 0.9rem;
      }

      /* 加载状态 */
      .loading {
        display: none;
        margin: 1.5rem 0;
        color: var(--primary-light);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .loading.active {
        display: flex;
      }

      .loading-spinner {
        width: 16px;
        height: 16px;
        border: 2px solid rgba(99, 102, 241, 0.2);
        border-radius: 50%;
        border-top-color: var(--primary-light);
        animation: spin 1s linear infinite;
      }

      /* 预测结果 */
      .prediction-result {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        border: 1px solid rgba(99, 102, 241, 0.15);
        display: none;
      }

      .prediction-result.active {
        display: block;
        animation: slideUp 0.5s ease forwards;
      }

      .prediction-header {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 1rem;
      }

      .prediction-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
      }

      .prediction-badge {
        display: inline-block;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary-light);
        font-size: 0.8rem;
        font-weight: 600;
        margin-left: 0.5rem;
      }

      .result-content {
        color: var(--text-light);
        line-height: 1.8;
      }

      .result-metric {
        margin-bottom: 1rem;
      }

      .metric-label {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 0.3rem;
      }

      .metric-value {
        font-weight: 600;
        color: var(--text);
        font-size: 1rem;
      }

      .metric-value.highlight {
        color: var(--primary-light);
      }

      .recommendation-list {
        margin-top: 1rem;
        padding-left: 1.5rem;
      }

      .recommendation-list li {
        margin-bottom: 0.8rem;
        color: var(--text-light);
        line-height: 1.6;
      }

      /* AI分析模块 */
      .ai-textarea {
        width: 100%;
        min-height: 180px;
        padding: 1rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.15);
        border-radius: var(--radius-sm);
        color: var(--text);
        font-size: 0.9rem;
        resize: vertical;
        transition: var(--transition);
        line-height: 1.6;
      }

      .ai-textarea:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        background: rgba(30, 41, 59, 1);
      }

      .result-card {
        margin-top: 2rem;
        padding: 1.8rem;
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        border: 1px solid rgba(99, 102, 241, 0.15);
        display: none;
      }

      .result-card.active {
        display: block;
        animation: slideUp 0.5s ease forwards;
      }

      .result-header {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 1.2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      }

      .result-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: rgba(16, 185, 129, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #10b981;
      }

      .ai-result-content {
        white-space: pre-line;
        color: var(--text-light);
        line-height: 1.8;
        font-size: 0.95rem;
      }

      /* 模型评估模块 */
      .eval-report-card {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(30, 41, 59, 0.6);
        border-radius: var(--radius-md);
        border: 1px solid rgba(99, 102, 241, 0.15);
      }

      .eval-header {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 1rem;
      }

      .eval-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
      }

      .eval-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }

      .eval-metric-item {
        padding: 1rem;
        background: rgba(15, 23, 42, 0.5);
        border-radius: var(--radius-sm);
        border-left: 3px solid var(--primary-light);
      }

      .eval-metric-label {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 0.3rem;
      }

      .eval-metric-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
      }

      /* 动画 */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* 响应式 */
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }

        .content-card {
          padding: 1.5rem;
        }

        .navbar {
          padding: 1rem;
        }

        .logo-text {
          font-size: 1rem;
        }

        .content-title {
          font-size: 1.25rem;
        }

        .tab-btn {
          padding: 0.7rem 1.2rem;
          font-size: 0.85rem;
        }

        .btn-primary,
        .btn-secondary {
          padding: 0.8rem 1.5rem;
          font-size: 0.85rem;
          width: 100%;
          justify-content: center;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .chart-grid {
          grid-template-columns: 1fr;
        }

        .chart-card {
          height: 300px;
        }

        .chart-container {
          height: 250px !important;
        }

        .data-table th,
        .data-table td {
          padding: 0.5rem;
          font-size: 0.75rem;
        }
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <div class="navbar-logo">
        <div class="logo-icon">Z</div>
        <div>
          <div class="logo-text">Z世代分析平台</div>
          <div class="navbar-tagline">基于CSV数据的用户画像分析</div>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="portrait">
          <i class="fas fa-chart-pie"></i> 基础画像分析
        </button>
        <button class="tab-btn" data-tab="predict">
          <i class="fas fa-user-tag"></i> 细分客群识别
        </button>
        <button class="tab-btn" data-tab="eval">
          <i class="fas fa-chart-line"></i> 模型评估报告
        </button>
        <button class="tab-btn" data-tab="ai">
          <i class="fas fa-robot"></i> AI智能分析
        </button>
      </div>

      <!-- 基础画像分析（核心模块） -->
      <div class="content-card active" id="portrait">
        <div class="content-header">
          <h2 class="content-title">
            <i class="fas fa-chart-pie"></i> 基础画像分析
          </h2>
          <p class="content-desc">自动加载数据，生成用户画像可视化图表</p>
        </div>

        <!-- 文件上传区域 - 保留供手动上传备选 -->
        <div class="file-upload" id="fileUploadArea">
          <input type="file" id="fileInput" accept=".csv" />
          <div class="file-upload-icon">
            <i class="fas fa-file-csv"></i>
          </div>
          <div class="file-upload-text">
            点击或拖拽CSV文件到此处上传（可选）
          </div>
          <div class="file-upload-hint">
            支持格式: .csv，建议文件大小不超过10MB。系统会自动加载默认数据。
          </div>
        </div>

        <!-- 数据加载提示 -->
        <div class="data-loading" id="dataLoading">
          <div class="data-loading-icon">
            <i class="fas fa-database"></i>
          </div>
          <div class="data-loading-text">正在加载数据...</div>
          <div class="csv-upload-hint">请稍候，正在处理数据文件</div>
        </div>

        <!-- CSV上传状态 -->
        <div class="csv-status" id="csvStatus">
          <i class="fas fa-check-circle"></i>
          <span id="csvStatusText">已成功加载数据，共 0 条记录</span>
        </div>

        <!-- 数据预览区域 -->
        <div class="data-preview" id="dataPreview">
          <div class="data-preview-header">
            <h3 class="data-preview-title">
              <i class="fas fa-table"></i> 数据预览
            </h3>
            <span style="color: var(--text-muted); font-size: 0.85rem"
              >显示前10条记录</span
            >
          </div>
          <div class="data-table-container">
            <table class="data-table" id="dataTable">
              <!-- 动态生成表格内容 -->
            </table>
          </div>
        </div>

        <!-- 刷新按钮 -->
        <button
          class="btn-secondary"
          id="refreshPortrait"
          style="margin-bottom: 1.5rem; display: none"
        >
          <i class="fas fa-sync-alt"></i> 刷新画像数据
        </button>

        <!-- 加载状态 -->
        <div class="loading" id="portraitLoading">
          <div class="loading-spinner"></div>
          正在生成画像数据...
        </div>

        <!-- 图表区域（初始隐藏，加载数据后显示） -->
        <div class="chart-grid" id="chartGrid" style="display: none">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="fas fa-calendar-alt"></i> 年龄分布
              </h3>
            </div>
            <div class="chart-container" id="ageChart"></div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title"><i class="fas fa-city"></i> 城市分布</h3>
            </div>
            <div class="chart-container" id="cityChart"></div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="fas fa-wallet"></i> 消费特征（月均）
              </h3>
            </div>
            <div class="chart-container" id="consumeChart"></div>
          </div>

          <div class="chart-card" style="grid-column: 1 / -1">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="fas fa-heart"></i> APP使用偏好分布
              </h3>
            </div>
            <div class="chart-container" id="interestChart"></div>
          </div>
        </div>
      </div>

      <!-- 细分客群识别 -->
      <div class="content-card" id="predict">
        <div class="content-header">
          <h2 class="content-title">
            <i class="fas fa-user-tag"></i> Z世代客群识别
          </h2>
          <p class="content-desc">
            从上传数据选择用户，识别其所属细分客群并获取运营建议
          </p>
        </div>

        <!-- 提示信息：请先上传数据 -->
        <div
          id="uploadPrompt"
          style="margin: 2rem 0; text-align: center; color: var(--text-muted)"
        >
          <i
            class="fas fa-info-circle"
            style="color: var(--primary-light); margin-right: 0.5rem"
          ></i>
          请等待数据加载完成...
        </div>

        <!-- 用户选择 -->
        <div class="form-group" id="userSelectWrapper" style="display: none">
          <label class="form-label">从上传数据选择用户</label>
          <select class="form-input" id="userIdSelect" disabled>
            <option value="">请等待数据加载完成...</option>
          </select>
        </div>

        <!-- 基础属性 -->
        <div class="category" style="display: none">
          <i class="fas fa-user"></i> 基础属性
        </div>
        <div class="form-grid" id="basicAttributes" style="display: none">
          <div class="form-group">
            <label class="form-label">USER_ID (用户ID)</label>
            <input
              type="text"
              class="form-input"
              id="USER_ID"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">MSISDN (手机号码)</label>
            <input
              type="text"
              class="form-input"
              id="MSISDN"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">PROV (省份)</label>
            <input
              type="text"
              class="form-input"
              id="PROV"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">CITY (城市)</label>
            <input
              type="text"
              class="form-input"
              id="CITY"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">AGE (年龄)</label>
            <input
              type="number"
              class="form-input"
              id="AGE"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">INNET_DURA (入网时长)</label>
            <input
              type="number"
              class="form-input"
              id="INNET_DURA"
              placeholder="无数据"
              disabled
            />
          </div>
        </div>

        <!-- 终端与套餐信息 -->
        <div class="category" style="display: none">
          <i class="fas fa-mobile-alt"></i> 终端与套餐信息
        </div>
        <div class="form-grid" id="devicePackageInfo" style="display: none">
          <div class="form-group">
            <label class="form-label">TERM_BRAND (终端品牌)</label>
            <input
              type="text"
              class="form-input"
              id="TERM_BRAND"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">IS_ORD_5G_PACKAGE (是否开通5G套餐)</label>
            <select class="form-input" id="IS_ORD_5G_PACKAGE" disabled>
              <option value="">无数据</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">PRI_PACKAGE_FEE (主套餐费用)</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="PRI_PACKAGE_FEE"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">IS_DUALSIM_USER (是否双卡用户)</label>
            <select class="form-input" id="IS_DUALSIM_USER" disabled>
              <option value="">无数据</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">PACKAGE_TYP (套餐类型)</label>
            <input
              type="text"
              class="form-input"
              id="PACKAGE_TYP"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >IS_TERM_CONTR_USER (是否终端合约用户)</label
            >
            <select class="form-input" id="IS_TERM_CONTR_USER" disabled>
              <option value="">无数据</option>
            </select>
          </div>
        </div>

        <!-- 网络使用特征 -->
        <div class="category" style="display: none">
          <i class="fas fa-wifi"></i> 网络使用特征
        </div>
        <div class="form-grid" id="networkUsage" style="display: none">
          <div class="form-group">
            <label class="form-label">day_flux (日间流量GB)</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="day_flux"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">night_flux (夜间流量GB)</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="night_flux"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >L3M_AVG_23G_FLUX_RATE (2/3G流量占比)</label
            >
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="L3M_AVG_23G_FLUX_RATE"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >L3M_AVG_FLUX_USE_CNT (近3月平均流量使用次数)</label
            >
            <input
              type="number"
              class="form-input"
              id="L3M_AVG_FLUX_USE_CNT"
              placeholder="无数据"
              disabled
            />
          </div>
        </div>

        <!-- APP使用特征 -->
        <div class="category" style="display: none">
          <i class="fas fa-mobile-app"></i> APP使用特征
        </div>
        <div class="form-grid" id="appUsage" style="display: none">
          <div class="form-group">
            <label class="form-label"
              >N3M_AVG_GAME_APP_USE_DAYS (近3月平均游戏APP使用天数)</label
            >
            <input
              type="number"
              class="form-input"
              id="N3M_AVG_GAME_APP_USE_DAYS"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >N3M_AVG_SOCIAL_APP_USE_DAYS (近3月平均社交APP使用天数)</label
            >
            <input
              type="number"
              class="form-input"
              id="N3M_AVG_SOCIAL_APP_USE_DAYS"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >N3M_AVG_MUSIC_APP_USE_DAYS (近3月平均音乐APP使用天数)</label
            >
            <input
              type="number"
              class="form-input"
              id="N3M_AVG_MUSIC_APP_USE_DAYS"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >N3M_AVG_VIDEO_APP_USE_DAYS (近3月平均视频APP使用天数)</label
            >
            <input
              type="number"
              class="form-input"
              id="N3M_AVG_VIDEO_APP_USE_DAYS"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >N3M_AVG_SHOP_APP_USE_DAYS (近3月平均购物APP使用天数)</label
            >
            <input
              type="number"
              class="form-input"
              id="N3M_AVG_SHOP_APP_USE_DAYS"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >N3M_AVG_LEARN_APP_USE_DAYS (近3月平均学习APP使用天数)</label
            >
            <input
              type="number"
              class="form-input"
              id="N3M_AVG_LEARN_APP_USE_DAYS"
              placeholder="无数据"
              disabled
            />
          </div>
        </div>

        <!-- 消费特征 -->
        <div class="category" style="display: none">
          <i class="fas fa-credit-card"></i> 消费特征
        </div>
        <div class="form-grid" id="consumptionFeatures" style="display: none">
          <div class="form-group">
            <label class="form-label">DIS_ARPU (当月ARPU值)</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="DIS_ARPU"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">N3M_AVG_DIS_ARPU (近3月平均ARPU值)</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="N3M_AVG_DIS_ARPU"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label">ACCT_BAL (账户余额)</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="ACCT_BAL"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >L3M_AVG_VOICE_OVER_FEE (近3月平均语音超套费用)</label
            >
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="L3M_AVG_VOICE_OVER_FEE"
              placeholder="无数据"
              disabled
            />
          </div>
          <div class="form-group">
            <label class="form-label"
              >L3M_AVG_FLUX_OVER_FEE (近3月平均流量超套费用)</label
            >
            <input
              type="number"
              step="0.01"
              class="form-input"
              id="L3M_AVG_FLUX_OVER_FEE"
              placeholder="无数据"
              disabled
            />
          </div>
        </div>

        <!-- 位置特征 -->
        <div class="category" style="display: none">
          <i class="fas fa-map-marker-alt"></i> 位置特征
        </div>
        <div class="form-grid" id="locationFeatures" style="display: none">
          <div class="form-group">
            <label class="form-label"
              >T_school_resident (当前是否校园常驻)</label
            >
            <select class="form-input" id="T_school_resident" disabled>
              <option value="">无数据</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label"
              >T_company_resident (当前是否公司常驻)</label
            >
            <select class="form-input" id="T_company_resident" disabled>
              <option value="">无数据</option>
            </select>
          </div>
        </div>

        <!-- 分析按钮 -->
        <div class="btn-group" id="analysisButtonGroup" style="display: none">
          <button class="btn-primary" id="analyzeUser">
            <i class="fas fa-search"></i> 分析用户特征
          </button>
        </div>

        <!-- 加载状态 -->
        <div class="loading" id="predictionLoading">
          <div class="loading-spinner"></div>
          正在分析用户特征并识别客群...
        </div>

        <!-- 预测结果 -->
        <div class="prediction-result" id="predictionResult">
          <div class="prediction-header">
            <h3 class="prediction-title">
              <i class="fas fa-user-check"></i> 客群识别结果
            </h3>
            <span class="prediction-badge" id="predictionConfidence"
              >匹配度: --%</span
            >
          </div>
          <div class="result-content">
            <div class="result-metric">
              <div class="metric-label">识别客群</div>
              <div class="metric-value highlight" id="predictedGroup">--</div>
            </div>

            <div class="result-metric">
              <div class="metric-label">用户特征总结</div>
              <div class="metric-value" id="userFeatureSummary">--</div>
            </div>

            <div class="result-metric">
              <div class="metric-label">运营建议</div>
              <ul class="recommendation-list" id="recommendations">
                <li>--</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- 模型评估报告 -->
      <div class="content-card" id="eval">
        <div class="content-header">
          <h2 class="content-title">
            <i class="fas fa-chart-line"></i> 模型评估报告
          </h2>
          <p class="content-desc">客群识别模型的性能评估指标与可视化分析</p>
        </div>

        <!-- 提示信息：请先上传数据 -->
        <div
          id="evalUploadPrompt"
          style="margin: 2rem 0; text-align: center; color: var(--text-muted)"
        >
          <i
            class="fas fa-info-circle"
            style="color: var(--primary-light); margin-right: 0.5rem"
          ></i>
          请先在"基础画像分析"页面上传CSV数据文件
        </div>

        <!-- 生成评估报告按钮 -->
        <div
          class="btn-group"
          id="generateEvalButtonGroup"
          style="display: none"
        >
          <button class="btn-primary" id="generateEvalReport">
            <i class="fas fa-file-alt"></i> 生成评估报告
          </button>
        </div>

        <!-- 加载状态 -->
        <div class="loading" id="evalLoading">
          <div class="loading-spinner"></div>
          正在生成模型评估报告...
        </div>

        <!-- 评估报告内容 -->
        <div id="evalReportContent" style="display: none">
          <div class="eval-report-card">
            <div class="eval-header">
              <h3 class="eval-title">
                <i class="fas fa-chart-pie"></i> 模型性能指标
              </h3>
            </div>
            <div class="eval-metrics">
              <div class="eval-metric-item">
                <div class="eval-metric-label">准确率 (Accuracy)</div>
                <div class="eval-metric-value" id="accuracy">--</div>
              </div>
              <div class="eval-metric-item">
                <div class="eval-metric-label">精确率 (Precision)</div>
                <div class="eval-metric-value" id="precision">--</div>
              </div>
              <div class="eval-metric-item">
                <div class="eval-metric-label">召回率 (Recall)</div>
                <div class="eval-metric-value" id="recall">--</div>
              </div>
              <div class="eval-metric-item">
                <div class="eval-metric-label">F1分数</div>
                <div class="eval-metric-value" id="f1Score">--</div>
              </div>
            </div>
          </div>

          <div class="chart-grid" style="margin-top: 2rem">
            <div class="chart-card">
              <div class="chart-header">
                <h3 class="chart-title">
                  <i class="fas fa-chart-bar"></i> 各类别精确率对比
                </h3>
              </div>
              <div class="chart-container" id="precisionChart"></div>
            </div>
            <div class="chart-card">
              <div class="chart-header">
                <h3 class="chart-title">
                  <i class="fas fa-chart-bar"></i> 各类别召回率对比
                </h3>
              </div>
              <div class="chart-container" id="recallChart"></div>
            </div>
            <div class="chart-card" style="grid-column: 1 / -1">
              <div class="chart-header">
                <h3 class="chart-title">
                  <i class="fas fa-chart-pie"></i> 混淆矩阵
                </h3>
              </div>
              <div class="chart-container" id="confusionMatrix"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- AI智能分析 -->
      <div class="content-card" id="ai">
        <div class="content-header">
          <h2 class="content-title"><i class="fas fa-robot"></i> AI智能分析</h2>
          <p class="content-desc">
            通过AI对Z世代用户数据进行深度分析，获取洞察与建议
          </p>
        </div>

        <!-- 提示信息：请先上传数据 -->
        <div
          id="aiUploadPrompt"
          style="margin: 2rem 0; text-align: center; color: var(--text-muted)"
        >
          <i
            class="fas fa-info-circle"
            style="color: var(--primary-light); margin-right: 0.5rem"
          ></i>
          请先在"基础画像分析"页面上传CSV数据文件
        </div>

        <!-- AI分析输入区域 -->
        <div id="aiAnalysisArea" style="display: none">
          <div class="form-group">
            <label class="form-label"
              >请输入您想分析的问题（例如：Z世代用户的主要消费特征是什么？）</label
            >
            <textarea
              class="ai-textarea"
              id="aiQuestion"
              placeholder="请输入您的问题..."
            ></textarea>
          </div>

          <div class="btn-group">
            <button class="btn-primary" id="submitAiQuestion">
              <i class="fas fa-paper-plane"></i> 提交分析请求
            </button>
            <button class="btn-secondary" id="clearAiQuestion">
              <i class="fas fa-eraser"></i> 清空
            </button>
          </div>

          <!-- 加载状态 -->
          <div class="loading" id="aiLoading">
            <div class="loading-spinner"></div>
            AI正在分析数据并生成回答...
          </div>

          <!-- AI分析结果 -->
          <div class="result-card" id="aiResultCard">
            <div class="result-header">
              <div class="result-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <h3 class="result-title">AI分析结果</h3>
            </div>
            <div class="ai-result-content" id="aiResultContent">
              <!-- AI分析结果将在这里显示 -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 全局变量存储解析后的CSV数据
      let csvData = null;
      let csvHeaders = [];

      // DOM元素
      const tabBtns = document.querySelectorAll(".tab-btn");
      const contentCards = document.querySelectorAll(".content-card");
      const fileInput = document.getElementById("fileInput");
      const fileUploadArea = document.getElementById("fileUploadArea");
      const dataLoading = document.getElementById("dataLoading");
      const csvStatus = document.getElementById("csvStatus");
      const csvStatusText = document.getElementById("csvStatusText");
      const dataPreview = document.getElementById("dataPreview");
      const dataTable = document.getElementById("dataTable");
      const refreshPortrait = document.getElementById("refreshPortrait");
      const portraitLoading = document.getElementById("portraitLoading");
      const chartGrid = document.getElementById("chartGrid");
      const uploadPrompt = document.getElementById("uploadPrompt");
      const userSelectWrapper = document.getElementById("userSelectWrapper");
      const userIdSelect = document.getElementById("userIdSelect");

      // 页面加载完成后自动加载CSV数据
      document.addEventListener("DOMContentLoaded", function () {
        // 自动加载CSV数据
        loadCsvData();

        // 标签切换功能
        tabBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            const tabId = btn.getAttribute("data-tab");

            // 更新按钮状态
            tabBtns.forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");

            // 更新内容卡片状态
            contentCards.forEach((card) => {
              card.classList.remove("active");
              if (card.id === tabId) {
                card.classList.add("active");
              }
            });

            // 如果切换到细分客群识别标签且数据已加载，更新用户选择
            if (tabId === "predict" && csvData) {
              populateUserSelect();
            }

            // 如果切换到模型评估标签且数据已加载，显示生成报告按钮
            if (tabId === "eval" && csvData) {
              document.getElementById("evalUploadPrompt").style.display =
                "none";
              document.getElementById("generateEvalButtonGroup").style.display =
                "flex";
            }

            // 如果切换到AI分析标签且数据已加载，显示分析区域
            if (tabId === "ai" && csvData) {
              document.getElementById("aiUploadPrompt").style.display = "none";
              document.getElementById("aiAnalysisArea").style.display = "block";
            }
          });
        });

        // 文件上传区域点击事件
        fileUploadArea.addEventListener("click", () => {
          fileInput.click();
        });

        // 文件上传事件
        fileInput.addEventListener("change", handleFileUpload);

        // 刷新画像按钮事件
        refreshPortrait.addEventListener("click", refreshPortraitAnalysis);

        // 用户选择变化事件
        userIdSelect.addEventListener("change", handleUserSelection);

        // 分析用户按钮事件
        document
          .getElementById("analyzeUser")
          .addEventListener("click", analyzeUser);

        // 生成评估报告按钮事件
        document
          .getElementById("generateEvalReport")
          .addEventListener("click", generateEvalReport);

        // AI分析相关事件
        document
          .getElementById("submitAiQuestion")
          .addEventListener("click", submitAiQuestion);
        document
          .getElementById("clearAiQuestion")
          .addEventListener("click", clearAiQuestion);
      });

      // 加载CSV数据
      function loadCsvData() {
        // 显示加载状态
        dataLoading.style.display = "block";
        csvStatus.classList.remove("active");
        dataPreview.classList.remove("active");
        chartGrid.style.display = "none";
        refreshPortrait.style.display = "none";

        // 这里需要将CSV文件上传到GitHub仓库，并修改为正确的路径
        // 例如，如果文件放在仓库的data目录下，路径可能是：
        const csvUrl = "data/wutong.csv"; // 修改为实际的CSV文件URL

        // 使用PapaParse从URL加载CSV
        Papa.parse(csvUrl, {
          download: true,
          header: true,
          complete: function (results) {
            if (results.errors && results.errors.length > 0) {
              console.error("CSV解析错误:", results.errors);
              dataLoading.style.display = "none";
              csvStatusText.innerHTML = `数据加载失败: ${results.errors[0].message}`;
              csvStatus.style.background = "rgba(239, 68, 68, 0.1)";
              csvStatus.style.color = "#ef4444";
              csvStatus.classList.add("active");
              return;
            }

            // 存储解析后的数据
            csvData = results.data;
            csvHeaders = results.meta.fields;

            // 更新状态和预览
            updateDataStatusAndPreview();

            // 生成画像分析
            generatePortraitAnalysis();

            // 更新其他标签页状态
            updateOtherTabs();
          },
          error: function (error) {
            console.error("加载CSV时出错:", error);
            dataLoading.style.display = "none";
            csvStatusText.innerHTML = `加载数据失败: ${error.message}`;
            csvStatus.style.background = "rgba(239, 68, 68, 0.1)";
            csvStatus.style.color = "#ef4444";
            csvStatus.classList.add("active");
          },
        });
      }

      // 处理文件上传
      function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // 检查文件类型
        if (file.type !== "text/csv" && !file.name.endsWith(".csv")) {
          alert("请上传CSV格式的文件");
          return;
        }

        // 显示加载状态
        dataLoading.style.display = "block";
        csvStatus.classList.remove("active");
        dataPreview.classList.remove("active");
        chartGrid.style.display = "none";
        refreshPortrait.style.display = "none";

        // 解析CSV文件
        Papa.parse(file, {
          header: true,
          complete: function (results) {
            if (results.errors && results.errors.length > 0) {
              console.error("CSV解析错误:", results.errors);
              dataLoading.style.display = "none";
              csvStatusText.innerHTML = `数据解析失败: ${results.errors[0].message}`;
              csvStatus.style.background = "rgba(239, 68, 68, 0.1)";
              csvStatus.style.color = "#ef4444";
              csvStatus.classList.add("active");
              return;
            }

            // 存储解析后的数据
            csvData = results.data;
            csvHeaders = results.meta.fields;

            // 更新状态和预览
            updateDataStatusAndPreview();

            // 生成画像分析
            generatePortraitAnalysis();

            // 更新其他标签页状态
            updateOtherTabs();

            // 重置文件输入，允许重复上传同一文件
            fileInput.value = "";
          },
        });
      }

      // 更新数据状态和预览
      function updateDataStatusAndPreview() {
        // 隐藏加载状态
        dataLoading.style.display = "none";

        // 更新状态信息
        csvStatusText.innerHTML = `已成功加载数据，共 ${csvData.length} 条记录`;
        csvStatus.style.background = "rgba(16, 185, 129, 0.1)";
        csvStatus.style.color = "#10b981";
        csvStatus.classList.add("active");

        // 显示数据预览
        dataPreview.classList.add("active");
        generateDataPreview();

        // 显示刷新按钮
        refreshPortrait.style.display = "block";
      }

      // 生成数据预览表格
      function generateDataPreview() {
        if (
          !csvData ||
          csvData.length === 0 ||
          !csvHeaders ||
          csvHeaders.length === 0
        )
          return;

        // 清空表格
        dataTable.innerHTML = "";

        // 创建表头
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        // 只显示前5个列，避免表格过宽
        const displayHeaders = csvHeaders.slice(0, 5);
        displayHeaders.forEach((header) => {
          const th = document.createElement("th");
          th.textContent = header;
          headerRow.appendChild(th);
        });

        // 如果有更多列，添加一个省略列
        if (csvHeaders.length > 5) {
          const th = document.createElement("th");
          th.textContent = "...";
          headerRow.appendChild(th);
        }

        thead.appendChild(headerRow);
        dataTable.appendChild(thead);

        // 创建表格内容
        const tbody = document.createElement("tbody");
        const displayRows = csvData.slice(0, 10); // 只显示前10行

        displayRows.forEach((row) => {
          const tr = document.createElement("tr");

          // 添加前5列数据
          displayHeaders.forEach((header) => {
            const td = document.createElement("td");
            td.textContent = row[header] !== undefined ? row[header] : "";
            tr.appendChild(td);
          });

          // 如果有更多列，添加一个省略单元格
          if (csvHeaders.length > 5) {
            const td = document.createElement("td");
            td.textContent = "...";
            tr.appendChild(td);
          }

          tbody.appendChild(tr);
        });

        dataTable.appendChild(tbody);
      }

      // 刷新画像分析
      function refreshPortraitAnalysis() {
        if (!csvData || csvData.length === 0) return;

        // 显示加载状态
        portraitLoading.classList.add("active");
        chartGrid.style.display = "none";

        // 延迟执行，模拟加载过程
        setTimeout(() => {
          generatePortraitAnalysis();
          portraitLoading.classList.remove("active");
        }, 800);
      }

      // 生成画像分析图表
      function generatePortraitAnalysis() {
        if (!csvData || csvData.length === 0) return;

        // 显示图表区域
        chartGrid.style.display = "grid";

        // 生成年龄分布图表
        generateAgeChart();

        // 生成城市分布图表
        generateCityChart();

        // 生成消费特征图表
        generateConsumeChart();

        // 生成APP使用偏好图表
        generateInterestChart();
      }

      // 生成年龄分布图表
      function generateAgeChart() {
        const ageChart = echarts.init(document.getElementById("ageChart"));

        // 处理年龄数据
        const ageGroups = {
          "18岁以下": 0,
          "18-22岁": 0,
          "23-25岁": 0,
          "26-30岁": 0,
          "30岁以上": 0,
        };

        csvData.forEach((row) => {
          const age = parseInt(row.AGE || 0);
          if (isNaN(age)) return;

          if (age < 18) {
            ageGroups["18岁以下"]++;
          } else if (age >= 18 && age <= 22) {
            ageGroups["18-22岁"]++;
          } else if (age >= 23 && age <= 25) {
            ageGroups["23-25岁"]++;
          } else if (age >= 26 && age <= 30) {
            ageGroups["26-30岁"]++;
          } else {
            ageGroups["30岁以上"]++;
          }
        });

        // 配置图表
        const option = {
          tooltip: {
            trigger: "item",
          },
          legend: {
            top: "5%",
            left: "center",
            textStyle: {
              color: "#e2e8f0",
            },
          },
          series: [
            {
              name: "年龄分布",
              type: "pie",
              radius: ["40%", "70%"],
              avoidLabelOverlap: false,
              itemStyle: {
                borderRadius: 10,
                borderColor: "#1e293b",
                borderWidth: 2,
              },
              label: {
                show: false,
                position: "center",
              },
              emphasis: {
                label: {
                  show: true,
                  fontSize: "16",
                  fontWeight: "bold",
                  color: "#fff",
                },
              },
              labelLine: {
                show: false,
              },
              data: Object.entries(ageGroups).map(([name, value]) => ({
                name,
                value,
                itemStyle: {
                  color: getColorByIndex(Object.keys(ageGroups).indexOf(name)),
                },
              })),
            },
          ],
        };

        ageChart.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          ageChart.resize();
        });
      }

      // 生成城市分布图表
      function generateCityChart() {
        const cityChart = echarts.init(document.getElementById("cityChart"));

        // 处理城市数据，只取前10个城市
        const cityData = {};
        csvData.forEach((row) => {
          const city = row.CITY || "未知城市";
          cityData[city] = (cityData[city] || 0) + 1;
        });

        // 排序并取前10
        const sortedCities = Object.entries(cityData)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10);

        // 配置图表
        const option = {
          tooltip: {
            trigger: "axis",
            axisPointer: {
              type: "shadow",
            },
          },
          grid: {
            left: "3%",
            right: "4%",
            bottom: "3%",
            containLabel: true,
          },
          xAxis: {
            type: "value",
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
          },
          yAxis: {
            type: "category",
            data: sortedCities.map((item) => item[0]),
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
          },
          series: [
            {
              name: "用户数量",
              type: "bar",
              data: sortedCities.map((item, index) => ({
                value: item[1],
                itemStyle: {
                  color: getColorByIndex(index),
                },
              })),
              barWidth: "60%",
            },
          ],
        };

        cityChart.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          cityChart.resize();
        });
      }

      // 生成消费特征图表
      function generateConsumeChart() {
        const consumeChart = echarts.init(
          document.getElementById("consumeChart")
        );

        // 处理消费数据
        const arpuData = csvData
          .map((row) => parseFloat(row.DIS_ARPU || 0))
          .filter((value) => !isNaN(value) && value > 0);

        // 计算平均值和分布
        const avgArpu =
          arpuData.length > 0
            ? (
                arpuData.reduce((sum, val) => sum + val, 0) / arpuData.length
              ).toFixed(2)
            : 0;

        const arpuRanges = {
          "0-50元": 0,
          "51-100元": 0,
          "101-200元": 0,
          "201-300元": 0,
          "300元以上": 0,
        };

        arpuData.forEach((value) => {
          if (value <= 50) {
            arpuRanges["0-50元"]++;
          } else if (value <= 100) {
            arpuRanges["51-100元"]++;
          } else if (value <= 200) {
            arpuRanges["101-200元"]++;
          } else if (value <= 300) {
            arpuRanges["201-300元"]++;
          } else {
            arpuRanges["300元以上"]++;
          }
        });

        // 配置图表
        const option = {
          tooltip: {
            trigger: "item",
          },
          legend: {
            top: "5%",
            left: "center",
            textStyle: {
              color: "#e2e8f0",
            },
          },
          series: [
            {
              name: "月均消费分布",
              type: "pie",
              radius: ["40%", "70%"],
              avoidLabelOverlap: false,
              itemStyle: {
                borderRadius: 10,
                borderColor: "#1e293b",
                borderWidth: 2,
              },
              label: {
                show: false,
                position: "center",
              },
              emphasis: {
                label: {
                  show: true,
                  fontSize: "16",
                  fontWeight: "bold",
                  color: "#fff",
                },
              },
              labelLine: {
                show: false,
              },
              data: Object.entries(arpuRanges).map(([name, value], index) => ({
                name: `${name} (${((value / arpuData.length) * 100).toFixed(
                  1
                )}%)`,
                value,
                itemStyle: {
                  color: getColorByIndex(index),
                },
              })),
            },
          ],
          graphic: {
            elements: [
              {
                type: "text",
                left: "center",
                top: "50%",
                style: {
                  text: `平均: ${avgArpu}元`,
                  fontSize: 16,
                  fontWeight: "bold",
                  fill: "#e2e8f0",
                },
              },
            ],
          },
        };

        consumeChart.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          consumeChart.resize();
        });
      }

      // 生成APP使用偏好图表
      function generateInterestChart() {
        const interestChart = echarts.init(
          document.getElementById("interestChart")
        );

        // 处理APP使用数据
        const appCategories = [
          { name: "游戏", field: "N3M_AVG_GAME_APP_USE_DAYS" },
          { name: "社交", field: "N3M_AVG_SOCIAL_APP_USE_DAYS" },
          { name: "音乐", field: "N3M_AVG_MUSIC_APP_USE_DAYS" },
          { name: "视频", field: "N3M_AVG_VIDEO_APP_USE_DAYS" },
          { name: "购物", field: "N3M_AVG_SHOP_APP_USE_DAYS" },
          { name: "学习", field: "N3M_AVG_LEARN_APP_USE_DAYS" },
          { name: "阅读", field: "N3M_AVG_READ_APP_USE_DAYS" },
          { name: "办公", field: "N3M_AVG_OFFICE_APP_USE_DAYS" },
          { name: "出行", field: "N3M_AVG_TRIP_APP_USE_DAYS" },
          { name: "金融", field: "N3M_AVG_FINANC_APP_USE_DAYS" },
        ];

        // 计算每个类别的平均使用天数
        const appData = appCategories
          .map((category, index) => {
            let total = 0;
            let count = 0;

            csvData.forEach((row) => {
              const value = parseFloat(row[category.field] || 0);
              if (!isNaN(value) && value > 0) {
                total += value;
                count++;
              }
            });

            const avg = count > 0 ? (total / count).toFixed(1) : 0;
            return {
              name: category.name,
              value: parseFloat(avg),
              itemStyle: {
                color: getColorByIndex(index),
              },
            };
          })
          .sort((a, b) => b.value - a.value);

        // 配置图表
        const option = {
          tooltip: {
            trigger: "axis",
            axisPointer: {
              type: "shadow",
            },
            formatter: "{b}: {c} 天/月",
          },
          grid: {
            left: "3%",
            right: "4%",
            bottom: "3%",
            containLabel: true,
          },
          xAxis: {
            type: "category",
            data: appData.map((item) => item.name),
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
          },
          yAxis: {
            type: "value",
            name: "平均使用天数/月",
            nameTextStyle: {
              color: "#e2e8f0",
            },
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
            splitLine: {
              lineStyle: {
                color: "rgba(148, 163, 184, 0.1)",
              },
            },
          },
          series: [
            {
              name: "使用天数",
              type: "bar",
              data: appData,
              barWidth: "60%",
            },
          ],
        };

        interestChart.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          interestChart.resize();
        });
      }

      // 更新其他标签页状态
      function updateOtherTabs() {
        // 更新细分客群识别标签
        uploadPrompt.style.display = "none";
        userSelectWrapper.style.display = "block";
        populateUserSelect();

        // 显示表单分类标题和内容
        document.querySelectorAll(".category").forEach((el) => {
          el.style.display = "flex";
        });
        document.getElementById("basicAttributes").style.display = "grid";
        document.getElementById("devicePackageInfo").style.display = "grid";
        document.getElementById("networkUsage").style.display = "grid";
        document.getElementById("appUsage").style.display = "grid";
        document.getElementById("consumptionFeatures").style.display = "grid";
        document.getElementById("locationFeatures").style.display = "grid";
        document.getElementById("analysisButtonGroup").style.display = "flex";

        // 更新模型评估标签
        document.getElementById("evalUploadPrompt").style.display = "none";
        document.getElementById("generateEvalButtonGroup").style.display =
          "flex";

        // 更新AI分析标签
        document.getElementById("aiUploadPrompt").style.display = "none";
        document.getElementById("aiAnalysisArea").style.display = "block";
      }

      // 填充用户选择下拉框
      function populateUserSelect() {
        if (!csvData || csvData.length === 0) return;

        // 清空现有选项
        userIdSelect.innerHTML = "";

        // 添加默认选项
        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "请选择用户";
        userIdSelect.appendChild(defaultOption);

        // 添加用户选项
        csvData.forEach((row, index) => {
          const option = document.createElement("option");
          option.value = index;
          option.textContent = `用户 ${row.USER_ID || `#${index + 1}`}`;
          userIdSelect.appendChild(option);
        });

        // 启用下拉框
        userIdSelect.disabled = false;
      }

      // 处理用户选择变化
      function handleUserSelection() {
        const selectedIndex = userIdSelect.value;
        if (!selectedIndex) {
          // 重置表单
          resetUserForm();
          return;
        }

        // 获取选中的用户数据
        const userData = csvData[selectedIndex];
        if (!userData) return;

        // 填充表单数据
        populateUserForm(userData);

        // 隐藏之前的预测结果
        document.getElementById("predictionResult").classList.remove("active");
      }

      // 重置用户表单
      function resetUserForm() {
        const formFields = [
          "USER_ID",
          "MSISDN",
          "PROV",
          "CITY",
          "AGE",
          "INNET_DURA",
          "TERM_BRAND",
          "IS_ORD_5G_PACKAGE",
          "PRI_PACKAGE_FEE",
          "IS_DUALSIM_USER",
          "PACKAGE_TYP",
          "IS_TERM_CONTR_USER",
          "day_flux",
          "night_flux",
          "L3M_AVG_23G_FLUX_RATE",
          "L3M_AVG_FLUX_USE_CNT",
          "N3M_AVG_GAME_APP_USE_DAYS",
          "N3M_AVG_SOCIAL_APP_USE_DAYS",
          "N3M_AVG_MUSIC_APP_USE_DAYS",
          "N3M_AVG_VIDEO_APP_USE_DAYS",
          "N3M_AVG_SHOP_APP_USE_DAYS",
          "N3M_AVG_LEARN_APP_USE_DAYS",
          "DIS_ARPU",
          "N3M_AVG_DIS_ARPU",
          "ACCT_BAL",
          "L3M_AVG_VOICE_OVER_FEE",
          "L3M_AVG_FLUX_OVER_FEE",
          "T_school_resident",
          "T_company_resident",
        ];

        formFields.forEach((field) => {
          const element = document.getElementById(field);
          if (element) {
            if (element.tagName === "INPUT") {
              element.value = "";
              element.placeholder = "无数据";
            } else if (element.tagName === "SELECT") {
              element.value = "";
            }
          }
        });
      }

      // 填充用户表单数据
      function populateUserForm(userData) {
        const formFields = [
          "USER_ID",
          "MSISDN",
          "PROV",
          "CITY",
          "AGE",
          "INNET_DURA",
          "TERM_BRAND",
          "PRI_PACKAGE_FEE",
          "PACKAGE_TYP",
          "day_flux",
          "night_flux",
          "L3M_AVG_23G_FLUX_RATE",
          "L3M_AVG_FLUX_USE_CNT",
          "N3M_AVG_GAME_APP_USE_DAYS",
          "N3M_AVG_SOCIAL_APP_USE_DAYS",
          "N3M_AVG_MUSIC_APP_USE_DAYS",
          "N3M_AVG_VIDEO_APP_USE_DAYS",
          "N3M_AVG_SHOP_APP_USE_DAYS",
          "N3M_AVG_LEARN_APP_USE_DAYS",
          "DIS_ARPU",
          "N3M_AVG_DIS_ARPU",
          "ACCT_BAL",
          "L3M_AVG_VOICE_OVER_FEE",
          "L3M_AVG_FLUX_OVER_FEE",
        ];

        formFields.forEach((field) => {
          const element = document.getElementById(field);
          if (element && userData[field] !== undefined) {
            element.value = userData[field];
          }
        });

        // 处理下拉框字段
        const selectFields = [
          "IS_ORD_5G_PACKAGE",
          "IS_DUALSIM_USER",
          "IS_TERM_CONTR_USER",
          "T_school_resident",
          "T_company_resident",
        ];

        selectFields.forEach((field) => {
          const element = document.getElementById(field);
          if (element && userData[field] !== undefined) {
            // 清空现有选项
            element.innerHTML = "";

            // 添加当前值选项
            const option = document.createElement("option");
            option.value = userData[field];
            option.textContent =
              userData[field] === "1"
                ? "是"
                : userData[field] === "0"
                ? "否"
                : userData[field];
            element.appendChild(option);
          }
        });
      }

      // 分析用户特征
      function analyzeUser() {
        const selectedIndex = userIdSelect.value;
        if (!selectedIndex) {
          alert("请先选择一个用户");
          return;
        }

        // 获取选中的用户数据
        const userData = csvData[selectedIndex];
        if (!userData) return;

        // 显示加载状态
        document.getElementById("predictionLoading").classList.add("active");
        document.getElementById("predictionResult").classList.remove("active");

        // 模拟分析过程
        setTimeout(() => {
          // 隐藏加载状态
          document
            .getElementById("predictionLoading")
            .classList.remove("active");

          // 生成客群识别结果
          const result = generateUserGroupPrediction(userData);

          // 显示结果
          document.getElementById("predictedGroup").textContent = result.group;
          document.getElementById(
            "predictionConfidence"
          ).textContent = `匹配度: ${result.confidence}%`;
          document.getElementById("userFeatureSummary").textContent =
            result.summary;

          // 生成建议列表
          const recommendationsList =
            document.getElementById("recommendations");
          recommendationsList.innerHTML = "";
          result.recommendations.forEach((rec) => {
            const li = document.createElement("li");
            li.textContent = rec;
            recommendationsList.appendChild(li);
          });

          // 显示结果
          document.getElementById("predictionResult").classList.add("active");
        }, 1500);
      }

      // 生成用户客群预测
      function generateUserGroupPrediction(userData) {
        // 简单的规则引擎来识别用户群体
        const age = parseInt(userData.AGE || 0);
        const is5G = userData.IS_ORD_5G_PACKAGE === "1";
        const arpu = parseFloat(userData.DIS_ARPU || 0);
        const gameUsage = parseFloat(userData.N3M_AVG_GAME_APP_USE_DAYS || 0);
        const socialUsage = parseFloat(
          userData.N3M_AVG_SOCIAL_APP_USE_DAYS || 0
        );
        const videoUsage = parseFloat(userData.N3M_AVG_VIDEO_APP_USE_DAYS || 0);
        const schoolResident = userData.T_school_resident === "1";

        // 学生群体
        if (schoolResident && age >= 18 && age <= 24) {
          return {
            group: "校园活力族",
            confidence: Math.min(90 + (age > 22 ? -10 : 0), 95),
            summary: `该用户为${age}岁的校园用户，${
              is5G ? "已开通5G套餐" : "使用4G套餐"
            }，月均消费${arpu}元。偏好${
              socialUsage > gameUsage ? "社交" : "游戏"
            }类应用，同时也经常使用视频类应用。`,
            recommendations: [
              "推荐校园专属5G套餐，包含更多定向流量",
              "推出社交/游戏APP定向流量包优惠",
              "结合开学季、毕业季等时间节点开展促销活动",
              "考虑与校园周边商户合作推出联名优惠",
            ],
          };
        }

        // 游戏爱好者
        if (
          gameUsage > 15 &&
          gameUsage > socialUsage &&
          gameUsage > videoUsage
        ) {
          return {
            group: "电竞达人",
            confidence: Math.min(85 + (is5G ? 5 : 0), 95),
            summary: `该用户是重度游戏爱好者，平均每月使用游戏类应用${gameUsage}天，${
              is5G
                ? "已开通5G套餐，网络体验较好"
                : "使用非5G套餐，可能需要更好的网络体验"
            }。月均消费${arpu}元。`,
            recommendations: [
              "推荐高网速、低延迟的5G游戏套餐",
              "推出游戏定向流量包和加速服务",
              "与热门游戏合作开展联名活动或提供虚拟道具",
              "考虑推荐游戏外设相关产品优惠",
            ],
          };
        }

        // 社交达人
        if (
          socialUsage > 15 &&
          socialUsage > gameUsage &&
          socialUsage > videoUsage
        ) {
          return {
            group: "社交达人",
            confidence: 85,
            summary: `该用户是社交活跃用户，平均每月使用社交类应用${socialUsage}天，${
              is5G ? "已开通5G套餐" : "使用非5G套餐"
            }。月均消费${arpu}元。`,
            recommendations: [
              "推荐包含更多语音通话和社交APP定向流量的套餐",
              "推出多人共享套餐，适合与朋友家人共享",
              "考虑与社交平台合作推出专属活动",
              "提供云存储服务优惠，方便用户存储社交内容",
            ],
          };
        }

        // 视频爱好者
        if (
          videoUsage > 15 &&
          videoUsage > gameUsage &&
          videoUsage > socialUsage
        ) {
          return {
            group: "视频娱乐族",
            confidence: 85,
            summary: `该用户是视频内容重度消费者，平均每月使用视频类应用${videoUsage}天，${
              is5G ? "已开通5G套餐" : "使用非5G套餐"
            }。月均消费${arpu}元。`,
            recommendations: [
              "推荐包含大容量视频定向流量的套餐",
              "与主流视频平台合作推出联合会员",
              "考虑推出夜间流量包优惠，适合夜间观看习惯",
              "推荐高清视频适配的5G套餐",
            ],
          };
        }

        // 高消费用户
        if (arpu > 100) {
          return {
            group: "品质生活族",
            confidence: 80 + (is5G ? 5 : 0),
            summary: `该用户为高价值客户，月均消费${arpu}元，${
              is5G ? "已开通5G套餐" : "使用非5G套餐，可考虑升级"
            }。综合使用各类应用，消费能力强。`,
            recommendations: [
              "推荐高端5G套餐，包含更多权益和服务",
              "提供专属客服和优先办理服务",
              "推荐终端合约计划，享受高端机型优惠",
              "邀请参与新品体验和高端活动",
            ],
          };
        }

        // 默认群体
        return {
          group: "综合均衡族",
          confidence: 75,
          summary: `该用户为${age}岁，${
            is5G ? "已开通5G套餐" : "使用非5G套餐"
          }，月均消费${arpu}元。应用使用较为均衡，没有特别突出的偏好。`,
          recommendations: [
            "推荐性价比高的综合套餐",
            "根据季节和节日推出短期优惠活动",
            "考虑推荐适合其年龄段的增值服务",
            "提供套餐个性化定制选项",
          ],
        };
      }

      // 生成评估报告
      function generateEvalReport() {
        // 显示加载状态
        document.getElementById("evalLoading").classList.add("active");
        document.getElementById("evalReportContent").style.display = "none";

        // 模拟生成报告过程
        setTimeout(() => {
          // 隐藏加载状态
          document.getElementById("evalLoading").classList.remove("active");

          // 显示报告内容
          document.getElementById("evalReportContent").style.display = "block";

          // 填充评估指标
          document.getElementById("accuracy").textContent = "87.5%";
          document.getElementById("precision").textContent = "86.2%";
          document.getElementById("recall").textContent = "85.8%";
          document.getElementById("f1Score").textContent = "86.0%";

          // 生成评估图表
          generatePrecisionChart();
          generateRecallChart();
          generateConfusionMatrix();
        }, 2000);
      }

      // 生成精确率图表
      function generatePrecisionChart() {
        const precisionChart = echarts.init(
          document.getElementById("precisionChart")
        );

        // 模拟数据
        const groups = [
          "校园活力族",
          "电竞达人",
          "社交达人",
          "视频娱乐族",
          "品质生活族",
          "综合均衡族",
        ];
        const precision = [0.89, 0.92, 0.85, 0.87, 0.9, 0.82];

        // 配置图表
        const option = {
          tooltip: {
            trigger: "axis",
            axisPointer: {
              type: "shadow",
            },
            formatter: "{b}: {c}%",
          },
          grid: {
            left: "3%",
            right: "4%",
            bottom: "3%",
            containLabel: true,
          },
          xAxis: {
            type: "value",
            max: 100,
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
              formatter: "{value}%",
            },
          },
          yAxis: {
            type: "category",
            data: groups,
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
          },
          series: [
            {
              name: "精确率",
              type: "bar",
              data: precision.map((value, index) => ({
                value: value * 100,
                itemStyle: {
                  color: getColorByIndex(index),
                },
              })),
              barWidth: "60%",
            },
          ],
        };

        precisionChart.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          precisionChart.resize();
        });
      }

      // 生成召回率图表
      function generateRecallChart() {
        const recallChart = echarts.init(
          document.getElementById("recallChart")
        );

        // 模拟数据
        const groups = [
          "校园活力族",
          "电竞达人",
          "社交达人",
          "视频娱乐族",
          "品质生活族",
          "综合均衡族",
        ];
        const recall = [0.87, 0.89, 0.86, 0.88, 0.83, 0.82];

        // 配置图表
        const option = {
          tooltip: {
            trigger: "axis",
            axisPointer: {
              type: "shadow",
            },
            formatter: "{b}: {c}%",
          },
          grid: {
            left: "3%",
            right: "4%",
            bottom: "3%",
            containLabel: true,
          },
          xAxis: {
            type: "value",
            max: 100,
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
              formatter: "{value}%",
            },
          },
          yAxis: {
            type: "category",
            data: groups,
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
          },
          series: [
            {
              name: "召回率",
              type: "bar",
              data: recall.map((value, index) => ({
                value: value * 100,
                itemStyle: {
                  color: getColorByIndex(index),
                },
              })),
              barWidth: "60%",
            },
          ],
        };

        recallChart.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          recallChart.resize();
        });
      }

      // 生成混淆矩阵
      function generateConfusionMatrix() {
        const confusionMatrix = echarts.init(
          document.getElementById("confusionMatrix")
        );

        // 模拟混淆矩阵数据
        const groups = [
          "校园活力族",
          "电竞达人",
          "社交达人",
          "视频娱乐族",
          "品质生活族",
          "综合均衡族",
        ];
        const data = [
          [89, 3, 2, 2, 1, 3],
          [2, 92, 1, 2, 2, 1],
          [3, 1, 85, 4, 2, 5],
          [1, 2, 3, 87, 3, 4],
          [2, 3, 1, 2, 83, 9],
          [4, 2, 5, 3, 8, 82],
        ];

        // 配置图表
        const option = {
          tooltip: {
            trigger: "item",
            formatter: "预测为 {b}<br>实际为 {a}<br>数量: {c}",
          },
          grid: {
            left: "15%",
            right: "10%",
            bottom: "15%",
          },
          xAxis: {
            type: "category",
            data: groups,
            name: "预测类别",
            nameLocation: "middle",
            nameGap: 30,
            nameTextStyle: {
              color: "#e2e8f0",
            },
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
              rotate: 30,
            },
          },
          yAxis: {
            type: "category",
            data: groups,
            name: "实际类别",
            nameLocation: "middle",
            nameGap: 50,
            nameTextStyle: {
              color: "#e2e8f0",
            },
            axisLine: {
              lineStyle: {
                color: "#94a3b8",
              },
            },
            axisLabel: {
              color: "#e2e8f0",
            },
          },
          visualMap: {
            min: 0,
            max: 100,
            calculable: true,
            orient: "horizontal",
            left: "center",
            bottom: "0%",
            textStyle: {
              color: "#e2e8f0",
            },
          },
          series: [
            {
              name: "混淆矩阵",
              type: "heatmap",
              data: data.flatMap((row, i) =>
                row.map((value, j) => ({
                  value,
                  itemStyle: {
                    color: i === j ? "#6366f1" : undefined, // 对角线使用主色调
                  },
                }))
              ),
              label: {
                show: true,
                color: "#fff",
              },
            },
          ],
        };

        confusionMatrix.setOption(option);

        // 响应窗口大小变化
        window.addEventListener("resize", () => {
          confusionMatrix.resize();
        });
      }

      // 提交AI分析问题
      function submitAiQuestion() {
        const question = document.getElementById("aiQuestion").value.trim();
        if (!question) {
          alert("请输入您想分析的问题");
          return;
        }

        // 显示加载状态
        document.getElementById("aiLoading").classList.add("active");
        document.getElementById("aiResultCard").classList.remove("active");

        // 模拟AI分析过程
        setTimeout(() => {
          // 隐藏加载状态
          document.getElementById("aiLoading").classList.remove("active");

          // 生成模拟的AI回答
          const answer = generateAiAnswer(question);

          // 显示结果
          document.getElementById("aiResultContent").textContent = answer;
          document.getElementById("aiResultCard").classList.add("active");
        }, 2500);
      }

      // 清空AI问题输入
      function clearAiQuestion() {
        document.getElementById("aiQuestion").value = "";
        document.getElementById("aiResultCard").classList.remove("active");
      }

      // 生成AI回答（模拟）
      function generateAiAnswer(question) {
        // 简单的问题匹配和回答生成
        if (question.includes("年龄") || question.includes("岁")) {
          return `根据分析，Z世代用户的年龄主要分布在18-30岁之间，其中18-22岁的用户占比约42%，23-25岁的用户占比约31%，26-30岁的用户占比约27%。

这个年龄段的用户普遍处于大学阶段到刚步入社会的时期，消费观念较为开放，对新鲜事物接受度高，是各类数字服务的主要消费群体。

建议针对不同年龄段的细分需求制定差异化的产品策略，例如为18-22岁的大学生群体提供高性价比的套餐，为26-30岁的职场新人提供更注重品质和服务的套餐。`;
        }

        if (
          question.includes("消费") ||
          question.includes("花费") ||
          question.includes("ARPU")
        ) {
          return `根据数据分析，Z世代用户的月均ARPU值（每用户平均收入）约为85元，高于整体用户平均水平。

消费特征呈现以下特点：
1. 5G套餐用户占比达68%，远高于其他年龄段
2. 流量消耗大，平均每月使用流量约15GB，其中视频和社交应用占比最高
3. 对增值服务的付费意愿强，尤其是游戏、视频会员等数字内容
4. 消费波动性较大，受促销活动和新品发布影响明显

建议优化5G套餐结构，增加定向流量包选项，并与热门数字内容提供商合作推出联合会员，提高用户粘性和ARPU值。`;
        }

        if (
          question.includes("APP") ||
          question.includes("应用") ||
          question.includes("偏好")
        ) {
          return `Z世代用户的APP使用偏好分析显示：

1. 社交类应用使用频率最高，平均每月使用25天以上
2. 视频类应用（包括短视频和长视频）日均使用时长超过2小时
3. 游戏应用在男性用户中渗透率达78%，女性用户中达52%
4. 购物类应用使用频率呈季节性波动，节假日前后明显上升
5. 学习类应用在学生群体中使用频率较高，尤其是在学期中

建议针对这些偏好，推出相应的定向流量包和增值服务，同时可以考虑与热门APP合作开展联合营销活动，提高用户活跃度和套餐价值感知。`;
        }

        // 默认回答
        return `根据对Z世代用户数据的综合分析，我们可以得出以下几点关键洞察：

1. 网络行为特征：Z世代用户是5G服务的主要采用者，对网络速度和稳定性有较高要求，日均上网时长超过5小时。

2. 消费习惯：倾向于选择灵活、个性化的套餐，对价格敏感但也愿意为优质内容和服务付费。

3. 设备使用：90%以上使用智能手机，其中高端机型占比达45%，更换设备的周期平均为18个月。

4. 社交属性：高度依赖社交网络，群体影响对消费决策的作用明显，口碑传播效果显著。

建议运营商针对这些特点，推出更具弹性的套餐方案，加强与内容提供商的合作，同时利用社交营销手段扩大影响力。`;
      }

      // 辅助函数：根据索引获取颜色
      function getColorByIndex(index) {
        const colors = [
          "#6366f1",
          "#8b5cf6",
          "#ec4899",
          "#f97316",
          "#10b981",
          "#06b6d4",
          "#64748b",
          "#a855f7",
          "#fb7185",
          "#f59e0b",
        ];
        return colors[index % colors.length];
      }
    </script>
  </body>
</html>
